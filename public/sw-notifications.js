/**
 * Service Worker para Notifica√ß√µes Push - Purify App
 * Gerencia notifica√ß√µes em background mesmo com app fechado
 */

const CACHE_NAME = 'purify-notifications-v1'
const NOTIFICATION_TAG = 'purify-daily'

// Notifica√ß√µes motivacionais di√°rias
const DAILY_NOTIFICATIONS = [
  {
    id: 'morning',
    title: 'üåÖ Bom dia, Guerreiro!',
    body: 'Mais um dia para fortalecer sua jornada. Voc√™ consegue!',
    icon: '/192.png',
    badge: '/72.png',
    tag: 'purify-morning',
    data: { type: 'daily', time: 'morning' },
    actions: [
      { action: 'open', title: '‚ú® Abrir App' },
      { action: 'motivate', title: 'üí™ Ver Motiva√ß√£o' }
    ]
  },
  {
    id: 'afternoon',
    title: '‚òÄÔ∏è For√ßa na Caminhada!',
    body: 'Como est√° sua tarde? Lembre-se: cada momento resistindo √© uma vit√≥ria.',
    icon: '/192.png',
    badge: '/72.png',
    tag: 'purify-afternoon',
    data: { type: 'daily', time: 'afternoon' },
    actions: [
      { action: 'open', title: 'üìä Ver Progresso' },
      { action: 'sos', title: 'üö® Preciso de Ajuda' }
    ]
  },
  {
    id: 'evening',
    title: 'üåÜ Reta Final do Dia!',
    body: 'Voc√™ est√° quase completando mais um dia limpo. Continue firme!',
    icon: '/192.png',
    badge: '/72.png',
    tag: 'purify-evening',
    data: { type: 'daily', time: 'evening' },
    actions: [
      { action: 'open', title: 'üèÜ Ver Conquistas' },
      { action: 'reflect', title: 'üôè Reflex√£o' }
    ]
  },
  {
    id: 'night',
    title: 'üåô Boa Noite, Vencedor!',
    body: 'Mais um dia de vit√≥ria! Descanse em paz sabendo que voc√™ venceu hoje.',
    icon: '/192.png',
    badge: '/72.png',
    tag: 'purify-night',
    data: { type: 'daily', time: 'night' },
    actions: [
      { action: 'open', title: '‚ú® Celebrar' },
      { action: 'gratitude', title: 'üôè Gratid√£o' }
    ]
  }
]

// Mensagens para marcos di√°rios
const MILESTONE_MESSAGES = [
  {
    days: 1,
    title: 'üéâ Primeiro Dia Completo!',
    body: 'Parab√©ns! Voc√™ completou seu primeiro dia limpo. O come√ßo √© sempre o mais dif√≠cil!'
  },
  {
    days: 3,
    title: 'üî• 3 Dias Conquistados!',
    body: 'Incr√≠vel! Tr√™s dias seguidos. Sua for√ßa de vontade est√° crescendo!'
  },
  {
    days: 7,
    title: 'üëë Uma Semana de Vit√≥rias!',
    body: 'WOW! Uma semana inteira! Voc√™ provou que consegue. Continue assim!'
  },
  {
    days: 14,
    title: 'üíé Duas Semanas Limpas!',
    body: 'Fant√°stico! 14 dias de transforma√ß√£o. Voc√™ est√° mudando sua vida!'
  },
  {
    days: 30,
    title: 'üöÄ UM M√äS DE SUPERA√á√ÉO!',
    body: 'INCR√çVEL! 30 dias limpos! Voc√™ j√° n√£o √© mais a mesma pessoa. Que orgulho!'
  },
  {
    days: 60,
    title: 'üèÜ 2 MESES DE PUREZA!',
    body: 'EXTRAORDIN√ÅRIO! 60 dias! Voc√™ est√° no caminho da transforma√ß√£o total!'
  },
  {
    days: 90,
    title: 'üåü 3 MESES DE NOVA VIDA!',
    body: 'FENOMENAL! 90 dias! Voc√™ reconstruiu completamente seus h√°bitos!'
  }
]

// Cita√ß√µes motivacionais
const MOTIVATIONAL_QUOTES = [
  {
    title: 'üí™ For√ßa Interior',
    body: 'Voc√™ √© mais forte do que qualquer tenta√ß√£o. Confie na sua capacidade de resistir!'
  },
  {
    title: 'üå± Crescimento',
    body: 'Cada "n√£o" que voc√™ diz √† tenta√ß√£o √© um "sim" para sua nova vida.'
  },
  {
    title: 'üéØ Foco no Objetivo',
    body: 'Lembre-se do motivo pelo qual voc√™ come√ßou. Sua liberdade vale cada esfor√ßo!'
  },
  {
    title: 'üî• Determina√ß√£o',
    body: 'Voc√™ j√° chegou t√£o longe! N√£o deixe que alguns minutos destruam dias de progresso.'
  },
  {
    title: '‚ú® Transforma√ß√£o',
    body: 'Voc√™ est√° se tornando a melhor vers√£o de si mesmo. Continue nessa jornada!'
  }
]

// Lembretes de emerg√™ncia
const EMERGENCY_REMINDERS = [
  {
    title: 'üö® Momento de Aten√ß√£o!',
    body: 'Este √© um hor√°rio de risco. Respire fundo e lembre-se dos seus objetivos!'
  },
  {
    title: 'üõ°Ô∏è Prote√ß√£o Ativa',
    body: 'Hora de usar suas estrat√©gias de prote√ß√£o. Voc√™ consegue superar isso!'
  },
  {
    title: '‚ö° For√ßa Agora',
    body: 'Momento cr√≠tico! Fa√ßa algo diferente: exercite-se, ore ou chame algu√©m.'
  }
]

// Rastreamento de h√°bitos
const HABIT_TRACKING = [
  {
    title: 'üìù Check-in Di√°rio',
    body: 'Como est√° seu dia? Registre seu progresso e sentimentos no app.'
  },
  {
    title: 'üéØ H√°bitos Saud√°veis',
    body: 'Que tal praticar um h√°bito positivo agora? Exerc√≠cio, leitura ou medita√ß√£o?'
  },
  {
    title: 'üìä Reflex√£o do Dia',
    body: 'Momento de refletir: o que funcionou bem hoje? O que pode melhorar?'
  }
]

// Lembretes espirituais
const SPIRITUAL_REMINDERS = [
  {
    title: 'üôè Momento de Ora√ß√£o',
    body: 'Pare alguns minutos para conversar com Deus. Ele est√° sempre pronto a te ouvir.'
  },
  {
    title: 'üìñ Palavra de Vida',
    body: 'Que tal ler um vers√≠culo b√≠blico? A Palavra de Deus fortalece sua alma.'
  },
  {
    title: '‚ú® Gratid√£o',
    body: 'Pense em 3 coisas pelas quais voc√™ √© grato hoje. Deus tem sido bom!'
  },
  {
    title: '‚õ™ Comunh√£o',
    body: 'Lembre-se de buscar comunh√£o com outros crist√£os. Juntos somos mais fortes!'
  }
]

// Notifica√ß√µes especiais de fim de semana
const WEEKEND_SPECIALS = [
  {
    type: 'friday',
    title: 'üéâ Sexta-feira Vitoriosa!',
    body: 'Mais uma semana de conquistas! Comemore suas vit√≥rias e descanse bem.'
  },
  {
    type: 'saturday',
    title: 'üåÖ S√°bado de Renova√ß√£o',
    body: 'Use este dia para renovar suas for√ßas. Tempo com Deus e descanso s√£o essenciais!'
  },
  {
    type: 'sunday',
    title: '‚õ™ Domingo Aben√ßoado',
    body: 'Dia especial para adora√ß√£o e prepara√ß√£o para uma nova semana de vit√≥rias!'
  }
]

// Instalar Service Worker
self.addEventListener('install', (event) => {
  console.log('üîî Service Worker de Notifica√ß√µes instalado')
  self.skipWaiting()
})

// Ativar Service Worker
self.addEventListener('activate', (event) => {
  console.log('üîî Service Worker de Notifica√ß√µes ativado')
  event.waitUntil(self.clients.claim())
})

// Listener para mensagens do app principal
self.addEventListener('message', (event) => {
  const { type, data } = event.data

  switch (type) {
    case 'SCHEDULE_DAILY_NOTIFICATIONS':
      scheduleDailyNotifications(data.times)
      break
    case 'SCHEDULE_MILESTONE_NOTIFICATION':
      scheduleMilestoneNotification(data.days)
      break
    case 'SCHEDULE_WEEKLY_REPORT':
      scheduleWeeklyReport(data.day, data.time)
      break
    case 'SCHEDULE_MOTIVATIONAL_QUOTES':
      scheduleMotivationalQuotes(data.intervals, data.randomize)
      break
    case 'SCHEDULE_EMERGENCY_REMINDERS':
      scheduleEmergencyReminders(data.riskyHours)
      break
    case 'SCHEDULE_HABIT_TRACKING':
      scheduleHabitTracking(data.checkInTimes, data.weeklyReview)
      break
    case 'SCHEDULE_SPIRITUAL_REMINDERS':
      scheduleSpiritualReminders(data.prayerTimes, data.bibleReading, data.worship)
      break
    case 'SCHEDULE_WEEKEND_SPECIALS':
      scheduleWeekendSpecials(data.fridayEvening, data.saturdayMorning, data.sundayEvening)
      break
    case 'CANCEL_ALL_NOTIFICATIONS':
      cancelAllNotifications()
      break
    case 'GET_SCHEDULED_NOTIFICATIONS':
      getScheduledNotifications().then(notifications => {
        event.ports[0].postMessage({ notifications })
      })
      break
  }
})

// Fun√ß√£o para agendar notifica√ß√µes di√°rias
async function scheduleDailyNotifications(times) {
  try {
    // Cancelar notifica√ß√µes anteriores
    const existingNotifications = await self.registration.getNotifications()
    existingNotifications.forEach(notification => {
      if (notification.tag.startsWith('purify-')) {
        notification.close()
      }
    })

    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())

    DAILY_NOTIFICATIONS.forEach((notification, index) => {
      const timeKey = notification.id // 'morning', 'afternoon', etc.
      const timeConfig = times[timeKey]
      
      if (timeConfig && timeConfig.enabled) {
        const [hours, minutes] = timeConfig.time.split(':').map(Number)
        const notificationTime = new Date(today)
        notificationTime.setHours(hours, minutes, 0, 0)

        // Se o hor√°rio j√° passou hoje, agendar para amanh√£
        if (notificationTime <= now) {
          notificationTime.setDate(notificationTime.getDate() + 1)
        }

        const delay = notificationTime.getTime() - now.getTime()

        setTimeout(() => {
          self.registration.showNotification(notification.title, {
            body: notification.body,
            icon: notification.icon,
            badge: notification.badge,
            tag: notification.tag,
            data: notification.data,
            actions: notification.actions,
            requireInteraction: false,
            silent: false,
            vibrate: [200, 100, 200]
          })

          // Reagendar para o pr√≥ximo dia
          setInterval(() => {
            if (isNotificationTimeEnabled(timeKey)) {
              self.registration.showNotification(notification.title, {
                body: notification.body,
                icon: notification.icon,
                badge: notification.badge,
                tag: notification.tag,
                data: notification.data,
                actions: notification.actions,
                requireInteraction: false,
                silent: false,
                vibrate: [200, 100, 200]
              })
            }
          }, 24 * 60 * 60 * 1000) // 24 horas
        }, delay)
      }
    })

    console.log('üìÖ Notifica√ß√µes di√°rias agendadas:', times)
  } catch (error) {
    console.error('‚ùå Erro ao agendar notifica√ß√µes di√°rias:', error)
  }
}

// Fun√ß√£o para agendar notifica√ß√£o de marco
function scheduleMilestoneNotification(currentDays) {
  const milestone = MILESTONE_MESSAGES.find(m => m.days === currentDays + 1)
  
  if (milestone) {
    // Agendar para 00:01 do pr√≥ximo dia
    const now = new Date()
    const tomorrow = new Date(now)
    tomorrow.setDate(tomorrow.getDate() + 1)
    tomorrow.setHours(0, 1, 0, 0) // 00:01

    const delay = tomorrow.getTime() - now.getTime()

    setTimeout(() => {
      self.registration.showNotification(milestone.title, {
        body: milestone.body,
        icon: '/192.png',
        badge: '/72.png',
        tag: `purify-milestone-${milestone.days}`,
        data: { type: 'milestone', days: milestone.days },
        actions: [
          { action: 'celebrate', title: 'üéâ Celebrar' },
          { action: 'share', title: 'üì± Compartilhar' }
        ],
        requireInteraction: true,
        silent: false,
        vibrate: [300, 100, 300, 100, 300]
      })
    }, delay)

    console.log(`üéØ Notifica√ß√£o de marco agendada para ${milestone.days} dias`)
  }
}

// Verificar se hor√°rio est√° habilitado (buscar do localStorage via mensagem)
function isNotificationTimeEnabled(timeKey) {
  // Esta fun√ß√£o ser√° melhorada para verificar configura√ß√µes em tempo real
  return true // Por enquanto, assume que est√° habilitado
}

// Cancelar todas as notifica√ß√µes
async function cancelAllNotifications() {
  try {
    const notifications = await self.registration.getNotifications()
    notifications.forEach(notification => notification.close())
    console.log('üö´ Todas as notifica√ß√µes canceladas')
  } catch (error) {
    console.error('‚ùå Erro ao cancelar notifica√ß√µes:', error)
  }
}

// Obter notifica√ß√µes agendadas
async function getScheduledNotifications() {
  try {
    const notifications = await self.registration.getNotifications()
    return notifications.map(n => ({
      title: n.title,
      body: n.body,
      tag: n.tag,
      data: n.data
    }))
  } catch (error) {
    console.error('‚ùå Erro ao obter notifica√ß√µes:', error)
    return []
  }
}

// Listener para clique em notifica√ß√µes
self.addEventListener('notificationclick', (event) => {
  const notification = event.notification
  const action = event.action
  const data = notification.data

  console.log('üîî Notifica√ß√£o clicada:', { action, data })

  notification.close()

  // Determinar URL baseada na a√ß√£o
  let targetUrl = '/'
  
  switch (action) {
    case 'motivate':
      targetUrl = '/motivacao'
      break
    case 'sos':
      targetUrl = '/emergencia'
      break
    case 'open':
      targetUrl = '/'
      break
    case 'reflect':
      targetUrl = '/bem-estar'
      break
    case 'celebrate':
    case 'share':
      targetUrl = '/estatistica'
      break
    default:
      if (data?.type === 'milestone') {
        targetUrl = '/gamificacao'
      } else {
        targetUrl = '/'
      }
  }

  // Abrir ou focar no app
  event.waitUntil(
    self.clients.matchAll({ type: 'window' }).then((clients) => {
      // Verificar se j√° existe uma janela aberta
      for (const client of clients) {
        if (client.url.includes(self.location.origin)) {
          client.navigate(targetUrl)
          return client.focus()
        }
      }
      
      // Se n√£o existe, abrir nova janela
      return self.clients.openWindow(targetUrl)
    })
  )

  // Enviar evento para analytics (opcional)
  if (data?.type) {
    self.clients.matchAll().then(clients => {
      clients.forEach(client => {
        client.postMessage({
          type: 'NOTIFICATION_CLICKED',
          data: { notificationType: data.type, action }
        })
      })
    })
  }
})

// Listener para fechar notifica√ß√£o
self.addEventListener('notificationclose', (event) => {
  console.log('üîî Notifica√ß√£o fechada:', event.notification.tag)
})

// Fun√ß√£o para agendar relat√≥rio semanal
function scheduleWeeklyReport(day, time) {
  const now = new Date()
  const targetDay = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'].indexOf(day.toLowerCase())
  
  if (targetDay === -1) return
  
  const nextDate = new Date(now)
  const currentDay = nextDate.getDay()
  const daysUntilTarget = (targetDay - currentDay + 7) % 7 || 7
  
  nextDate.setDate(nextDate.getDate() + daysUntilTarget)
  const [hours, minutes] = time.split(':').map(Number)
  nextDate.setHours(hours, minutes, 0, 0)
  
  const delay = nextDate.getTime() - now.getTime()
  
  setTimeout(() => {
    self.registration.showNotification('üìä Relat√≥rio Semanal', {
      body: 'Veja seu progresso da semana e planeje os pr√≥ximos dias!',
      icon: '/192.png',
      badge: '/72.png',
      tag: 'purify-weekly-report',
      data: { type: 'weekly-report' },
      actions: [
        { action: 'view-stats', title: 'üìä Ver Estat√≠sticas' },
        { action: 'plan-week', title: 'üìÖ Planejar Semana' }
      ],
      vibrate: [200, 100, 200]
    })
    
    // Reagendar para pr√≥xima semana
    setInterval(() => {
      self.registration.showNotification('üìä Relat√≥rio Semanal', {
        body: 'Veja seu progresso da semana e planeje os pr√≥ximos dias!',
        icon: '/192.png',
        badge: '/72.png',
        tag: 'purify-weekly-report',
        data: { type: 'weekly-report' },
        actions: [
          { action: 'view-stats', title: 'üìä Ver Estat√≠sticas' },
          { action: 'plan-week', title: 'üìÖ Planejar Semana' }
        ],
        vibrate: [200, 100, 200]
      })
    }, 7 * 24 * 60 * 60 * 1000) // 7 dias
  }, delay)
  
  console.log(`üìä Relat√≥rio semanal agendado para ${day} √†s ${time}`)
}

// Fun√ß√£o para agendar cita√ß√µes motivacionais
function scheduleMotivationalQuotes(intervals, randomize) {
  intervals.forEach((time, index) => {
    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    const [hours, minutes] = time.split(':').map(Number)
    const notificationTime = new Date(today)
    notificationTime.setHours(hours, minutes, 0, 0)
    
    if (notificationTime <= now) {
      notificationTime.setDate(notificationTime.getDate() + 1)
    }
    
    const delay = notificationTime.getTime() - now.getTime()
    
    setTimeout(() => {
      const sendQuote = () => {
        const quote = randomize 
          ? MOTIVATIONAL_QUOTES[Math.floor(Math.random() * MOTIVATIONAL_QUOTES.length)]
          : MOTIVATIONAL_QUOTES[index % MOTIVATIONAL_QUOTES.length]
        
        self.registration.showNotification(quote.title, {
          body: quote.body,
          icon: '/192.png',
          badge: '/72.png',
          tag: `purify-quote-${time.replace(':', '')}`,
          data: { type: 'motivational-quote' },
          actions: [
            { action: 'share-quote', title: 'üì± Compartilhar' },
            { action: 'more-motivation', title: 'üí™ Mais Motiva√ß√£o' }
          ],
          vibrate: [100, 50, 100]
        })
      }
      
      sendQuote()
      
      // Reagendar para todos os dias
      setInterval(sendQuote, 24 * 60 * 60 * 1000)
    }, delay)
  })
  
  console.log('üí¨ Cita√ß√µes motivacionais agendadas para:', intervals)
}

// Fun√ß√£o para agendar lembretes de emerg√™ncia
function scheduleEmergencyReminders(riskyHours) {
  riskyHours.forEach(time => {
    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    const [hours, minutes] = time.split(':').map(Number)
    const notificationTime = new Date(today)
    notificationTime.setHours(hours, minutes, 0, 0)
    
    if (notificationTime <= now) {
      notificationTime.setDate(notificationTime.getDate() + 1)
    }
    
    const delay = notificationTime.getTime() - now.getTime()
    
    setTimeout(() => {
      const sendReminder = () => {
        const reminder = EMERGENCY_REMINDERS[Math.floor(Math.random() * EMERGENCY_REMINDERS.length)]
        
        self.registration.showNotification(reminder.title, {
          body: reminder.body,
          icon: '/192.png',
          badge: '/72.png',
          tag: `purify-emergency-${time.replace(':', '')}`,
          data: { type: 'emergency-reminder' },
          actions: [
            { action: 'sos', title: 'üö® SOS' },
            { action: 'distract', title: 'üéØ Distrair-me' }
          ],
          requireInteraction: true,
          vibrate: [300, 100, 300, 100, 300]
        })
      }
      
      sendReminder()
      
      // Reagendar para todos os dias
      setInterval(sendReminder, 24 * 60 * 60 * 1000)
    }, delay)
  })
  
  console.log('üö® Lembretes de emerg√™ncia agendados para:', riskyHours)
}

// Fun√ß√£o para agendar rastreamento de h√°bitos
function scheduleHabitTracking(checkInTimes, weeklyReview) {
  checkInTimes.forEach((time, index) => {
    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    const [hours, minutes] = time.split(':').map(Number)
    const notificationTime = new Date(today)
    notificationTime.setHours(hours, minutes, 0, 0)
    
    if (notificationTime <= now) {
      notificationTime.setDate(notificationTime.getDate() + 1)
    }
    
    const delay = notificationTime.getTime() - now.getTime()
    
    setTimeout(() => {
      const sendTracking = () => {
        const tracking = HABIT_TRACKING[index % HABIT_TRACKING.length]
        
        self.registration.showNotification(tracking.title, {
          body: tracking.body,
          icon: '/192.png',
          badge: '/72.png',
          tag: `purify-habit-${time.replace(':', '')}`,
          data: { type: 'habit-tracking' },
          actions: [
            { action: 'log-mood', title: 'üòä Registrar Humor' },
            { action: 'track-habits', title: '‚úÖ Marcar H√°bitos' }
          ],
          vibrate: [150, 100, 150]
        })
      }
      
      sendTracking()
      
      // Reagendar para todos os dias
      setInterval(sendTracking, 24 * 60 * 60 * 1000)
    }, delay)
  })
  
  console.log('üìù Rastreamento de h√°bitos agendado para:', checkInTimes)
}

// Fun√ß√£o para agendar lembretes espirituais
function scheduleSpiritualReminders(prayerTimes, bibleReading, worship) {
  // Agendar hor√°rios de ora√ß√£o
  prayerTimes.forEach((time, index) => {
    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    const [hours, minutes] = time.split(':').map(Number)
    const notificationTime = new Date(today)
    notificationTime.setHours(hours, minutes, 0, 0)
    
    if (notificationTime <= now) {
      notificationTime.setDate(notificationTime.getDate() + 1)
    }
    
    const delay = notificationTime.getTime() - now.getTime()
    
    setTimeout(() => {
      const sendSpiritual = () => {
        const spiritual = SPIRITUAL_REMINDERS[index % SPIRITUAL_REMINDERS.length]
        
        self.registration.showNotification(spiritual.title, {
          body: spiritual.body,
          icon: '/192.png',
          badge: '/72.png',
          tag: `purify-spiritual-${time.replace(':', '')}`,
          data: { type: 'spiritual-reminder' },
          actions: [
            { action: 'pray', title: 'üôè Orar Agora' },
            { action: 'read-bible', title: 'üìñ Ler B√≠blia' }
          ],
          vibrate: [200, 100, 200]
        })
      }
      
      sendSpiritual()
      
      // Reagendar para todos os dias
      setInterval(sendSpiritual, 24 * 60 * 60 * 1000)
    }, delay)
  })
  
  console.log('üôè Lembretes espirituais agendados para:', prayerTimes)
}

// Fun√ß√£o para agendar notifica√ß√µes especiais de fim de semana
function scheduleWeekendSpecials(fridayEvening, saturdayMorning, sundayEvening) {
  const scheduleWeekendNotification = (dayIndex, time, specialType) => {
    const now = new Date()
    const currentDay = now.getDay()
    const daysUntilTarget = (dayIndex - currentDay + 7) % 7
    
    const targetDate = new Date(now)
    targetDate.setDate(targetDate.getDate() + daysUntilTarget)
    const [hours, minutes] = time.split(':').map(Number)
    targetDate.setHours(hours, minutes, 0, 0)
    
    if (targetDate <= now) {
      targetDate.setDate(targetDate.getDate() + 7)
    }
    
    const delay = targetDate.getTime() - now.getTime()
    
    setTimeout(() => {
      const sendWeekendSpecial = () => {
        const special = WEEKEND_SPECIALS.find(s => s.type === specialType)
        
        if (special) {
          self.registration.showNotification(special.title, {
            body: special.body,
            icon: '/192.png',
            badge: '/72.png',
            tag: `purify-weekend-${specialType}`,
            data: { type: 'weekend-special', specialType },
            actions: [
              { action: 'celebrate', title: 'üéâ Celebrar' },
              { action: 'plan', title: 'üìÖ Planejar' }
            ],
            vibrate: [200, 100, 200, 100, 200]
          })
        }
      }
      
      sendWeekendSpecial()
      
      // Reagendar para pr√≥xima semana
      setInterval(sendWeekendSpecial, 7 * 24 * 60 * 60 * 1000)
    }, delay)
  }
  
  // Sexta √† noite (5), S√°bado de manh√£ (6), Domingo √† noite (0)
  scheduleWeekendNotification(5, fridayEvening, 'friday')
  scheduleWeekendNotification(6, saturdayMorning, 'saturday')
  scheduleWeekendNotification(0, sundayEvening, 'sunday')
  
  console.log('üéâ Notifica√ß√µes especiais de fim de semana agendadas')
}

console.log('üîî Service Worker de Notifica√ß√µes carregado')
